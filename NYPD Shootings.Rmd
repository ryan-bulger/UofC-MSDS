---
title: "Evaluating NYPD Historical Shooting Incidents"
subtitle: "DTSA 5301, University of Colorado"
date: "March 6th, 2022"
output:
  pdf_document: default
---
```{r Setup markdown document, echo = FALSE}
pacman::p_load(tidyverse, lubridate, knitr)
knitr::opts_chunk$set(echo = TRUE,  results='hide', warning=FALSE, message=FALSE)
```
## OBJECTIVE
The objective of this analysis is to determine the demographics of when and where historical shootings in the City of New York using data from the New York Police Department, evaluated over a 15 year period from January 1st, 2006 to December 29th, 2020.  Throughout the analysis any sources of bias such as age or race will be identified and objectively evaluated to ensure a fair, balanced, and inclusive summary has been generated.

---

## IMPORTING & TIDYING DATA

### DATA IMPORT:
The first step will be to import the shootings data from the City of New York website.  A summary is run to determine the initial size of the imported data frame and the type of data in each column.  This is done to determine if it is required to change the data types of any columns in the data frame after it has been imported.  The data summary indicates that the data frame has 23,585 rows and 19 columns, and that a few of the columns are of the data class "character".
```{r Import Data}
#Import historical shootings data from the City of New York website
```


```{r Import Data}
url <- "https://data.cityofnewyork.us/api/views/833y-fsy8/rows.csv"
data_import <- read_csv(url)
```
``` {r Data Summary, results='hold'}
#Determine the initial shape and data types of the data frame
glimpse(data_import)
```
### TIDYING DATA:
The data can now be organized in a tidy fashion where each variable is in it's own column, and each observation is in it's own row.  The columns which are of the data type "character" will be changed to the type "factor" to allow for further analysis by grouping the data into common groups.  After tidying has been completed the resulting "shootings" data frame has 5,340 rows and 18 columns.
``` {r Tidy Data}
#Define column names to be changed into factor data type
column_names <- c('BORO','PRECINCT','JURISDICTION_CODE',
                  'LOCATION_DESC','STATISTICAL_MURDER_FLAG',
                  'PERP_AGE_GROUP','PERP_SEX','PERP_RACE',
                  'VIC_AGE_GROUP','VIC_SEX','VIC_RACE')

#Create "shootings" data frame by changing column data types and removing errant values
shootings <- data_import %>%
  na_if('UNKNOWN') %>% #Remove 'UNKNOWN' values from data frame
  na_if('NONE') %>% #Remove 'NONE' values from data frame
  drop_na() %>% #Remove NA values from data frame
  filter(!PERP_AGE_GROUP %in% c(224, 940, 1020), #Remove errant values in PERP_AGE_GROUP
         !PERP_SEX %in% 'U') %>% #Remove errant values in PERP_SEX column
  mutate(OCCUR_DATE = as_date(OCCUR_DATE, format = "%m/%d/%Y"), #Format date
         across(column_names, as_factor)) %>% #Change these cols to factors
  select(-Lon_Lat) #Remove Lon_Lat column

```
```{r, results='hold'}
#Determine shape and data types of the formatted "shootings" data frame
glimpse(shootings)
```

---

## EXPLORATORY DATA ANALYSIS

### DENSITY OF SHOOTINGS:
The next step is to determine which areas of New York city have had the most shootings over the 15 year period.  A map indicating the density of shootings is prepared below using the location that has been reported for each shooting.  To further the analysis the area's with higher densities of shootings will be isolated and the demographics of the shootings in these area's evaluated.  The map indicates that the boroughs of the Bronx, Brooklyn, and Manhattan have had the majority of the shootings in New York City during this time frame.
``` {r Plot Map, fig.width=6,fig.height=4}
shootings %>%
  ggplot() +
  geom_hex(aes(x=Longitude, y=Latitude, color=BORO)) +
  scale_fill_viridis_c(begin = 0.25, end=1) +
  guides(color=guide_legend("Borough"))
```

### SHOOTINGS BY AGE GROUPS:
A possible bias would be to assume that only young people (aged under 18) commit crimes.  The plot below indicates that the majority of perpetrators are actually below the ages 45.
``` {r, fig.width=6,fig.height=4}
shootings %>%
  filter(BORO %in% c('BRONX','MANHATTAN','BROOKLYN')) %>%
  mutate(PERP_AGE_GROUP=factor(PERP_AGE_GROUP, 
                               levels=c('<18','18-24','25-44','45-64','65+'))) %>%
  ggplot(aes(x = BORO, fill = PERP_AGE_GROUP)) +
  geom_bar() +
  scale_fill_viridis_d(option = "viridis", direction = 1) +
  labs(x=element_blank(), y="Number of shootings") +
  guides(fill=guide_legend("Perpetrators Age")) +
  theme_minimal()
```

### DISTRIBUTION OF WHEN SHOOTINGS OCCUR:
It would be interesting to understand the distribution of when shootings occurred in the Bronx, Brooklyn, and Manhattan for those perpetrators under the age of 45.  The plot below reveals an interesting trend such that the older a perpetrator is, the more likely they are to commit a shooting earlier in the day.
``` {r, fig.width=6,fig.height=4}
shootings %>%
  filter(BORO %in% c('BRONX','MANHATTAN','BROOKLYN'),
         PERP_AGE_GROUP %in% c('<18','18-24','25-44')) %>%
  ggplot() +
  geom_boxplot(aes(x=factor(PERP_AGE_GROUP, 
                            levels=c('<18','18-24','25-44')),
                            y=OCCUR_TIME)) +
  labs(x = 'Perpetrators ages', y = 'Time of Day (24hrs)') +
  facet_grid(cols=vars(BORO)) +
  guides(x = guide_axis(angle = 90))
```

### DYNAMICS OF RACE IN SHOOTINGS:
Another bias would be to only evaluate the data based on one particular race.  The data below compares the race of perpetrators under the age of 45 to the race of their victims in the Bronx, Brooklyn, and Manhattan.  Although the majority of shootings occur between Black people, the data shows that other races can also commit shootings.

``` {r, fig.width=7,fig.height=4}
shootings %>%
  filter(BORO %in% c('BRONX','MANHATTAN','BROOKLYN'),
         PERP_AGE_GROUP %in% c('<18','18-24','25-44')) %>%
  ggplot() +
  aes(y = PERP_RACE, fill = VIC_RACE) +
  geom_bar() +
  scale_fill_viridis_d(option = "viridis", direction = -1) +
  guides(x = guide_axis(angle = 90), fill=guide_legend("Victims Race")) +
  labs(x="Number of shootings", y="Perpetrators Race") +
  theme(legend.position=c(0.7,0.7), legend.key.width = unit(0.3,"cm"))
```

---

## CONCLUSION

In summary it has been shown that the majority of shootings have occured between Black people who are under the age or 45 in the boroughs of the Bronx, Brooklyn, and Manhattan.  Further analysis is required to understand the dynamics between perpetrators and their victims. In particular it would be important to understand why there is such a high rate of Black on Black shootings and how the location and time of day are factors in these crimes.

---

## R SESSION INFORMATION:
```{r, results='hold', echo=FALSE}
sessioninfo::package_info(pkgs = 'attached')
```